<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G/S Battle Simulator: Final Polish v2</title>
    <!-- Modular CSS -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/utils.css">
    <link rel="stylesheet" href="css/screens.css">
    <link rel="stylesheet" href="css/selection.css">
    <link rel="stylesheet" href="css/summary.css">
    <link rel="stylesheet" href="css/party.css">
    <link rel="stylesheet" href="css/pokedex.css">
    <link rel="stylesheet" href="css/pack.css">
    <link rel="stylesheet" href="css/battle.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/explosion.css">
    <link rel="stylesheet" href="css/evolution.css">
    <link rel="stylesheet" href="css/move_learn.css">
    <link rel="stylesheet" href="css/dialog.css">
</head>

<body>

    <div id="game-container">
        <div id="game-boy">
            <div id="lcd-overlay"></div>
            <div id="streak-box" class="hidden">WINS: 0</div>

            <!-- Start Screen -->
            <div id="start-screen">
                <div class="start-title">POKEMON<br>GOLD & SILVER<br>SIMULATION</div>
                <div class="start-btn" onclick="ScreenManager.getScreen('TITLE').checkSave()">CLICK TO START</div>
                <div class="toggle-box" onclick="Game.toggleLcd()">
                    <div class="checkbox" id="lcd-check"></div>
                    <span>RETRO FILTER</span>
                </div>
                <!-- NEW: Retro Motion Toggle -->
                <div class="toggle-box" onclick="Game.toggleRetroMotion()">
                    <div class="checkbox" id="motion-check"></div>
                    <span>RETRO MOTION</span>
                </div>
                <div style="font-size: 6px; color: #888; margin-top: 20px;">Z: CONFIRM | X: BACK | ARROWS: MOVE</div>
            </div>

            <!-- Name Input Screen -->
            <div id="name-screen" class="hidden">
                <!-- ... (unchanged) ... -->
                <div style="margin-bottom: 10px;">REGISTRATION</div>
                <div style="font-size: 8px; margin-bottom: 20px;">PLEASE ENTER YOUR NAME</div>
                <input type="text" id="name-input" maxlength="8" placeholder="NAME">
                <div class="start-btn" onclick="ScreenManager.push('SELECTION')">CONFIRM</div>
            </div>

            <!-- CONTINUE SCREEN -->
            <div id="continue-screen" class="hidden">
                <!-- ... (unchanged) ... -->
                <div class="cont-menu-box">
                    <div class="cont-opt" id="opt-continue" onclick="ScreenManager.getScreen('CONTINUE').confirm()">
                        CONTINUE</div>
                    <div class="cont-opt" id="opt-pokedex" onclick="ScreenManager.push('POKEDEX')">POKEDEX</div>
                    <div class="cont-opt" id="opt-newgame" onclick="ScreenManager.push('NAME_INPUT')">NEW GAME</div>
                </div>
                <div class="save-info-box">
                    <div class="save-row" style="color:yellow" id="save-name">PLAYER</div>
                    <div class="save-row"><span>WINS</span> <span id="save-wins">0</span></div>
                    <div class="save-row"><span>BOSSES</span> <span id="save-bosses">0</span></div>
                    <div class="save-row"><span>SEEN</span> <span id="save-seen">0</span></div>
                    <div class="save-row"><span>CAUGHT</span> <span id="save-caught">0</span></div>
                    <div class="party-preview-row" id="save-preview"></div>
                    <div style="font-size:6px; text-align:center; color:#888;">CLICK PKMN FOR INFO</div>
                </div>
            </div>

            <!-- Summary Screen -->
            <div id="summary-panel" class="hidden">
                <!-- ... (unchanged content, just preserving structure) ... -->
                <div class="sum-header">
                    <div style="font-weight: bold; font-size: 10px;" id="sum-name">NAME</div>
                    <div id="sum-shiny-icon" style="color:gold; font-size:10px; display:none;">✦</div>
                    <div id="sum-status-text" style="font-size:8px;">STATUS/OK</div>
                </div>
                <div class="sum-body">
                    <div class="sum-sprite"><img id="sum-sprite-img" src=""></div>
                    <div class="sum-data">
                        <div id="sum-types"></div>
                        <div style="margin-top:4px;">HP <span id="sum-hp-txt"></span></div>
                        <div class="sum-stat-bar">
                            <div class="sum-stat-fill" id="sum-hp-bar" style="background:var(--hp-green);"></div>
                        </div>
                        <div>EXP <span id="sum-exp-txt"></span></div>
                        <div class="sum-stat-bar">
                            <div class="sum-stat-fill" id="sum-exp-bar" style="background:var(--xp-blue);"></div>
                        </div>

                        <div class="sum-divider"></div>

                        <div id="summary-stats"></div>
                    </div>
                </div>
                <div style="font-size:8px; font-weight:bold; margin-bottom:2px;">MOVES:</div>
                <div id="summary-moves" class="sum-moves"></div>
                <div class="sum-buttons">
                    <button class="confirm-btn nav-btn" id="btn-prev">&lt;</button>
                    <button class="confirm-btn" id="btn-action">ACTION</button>
                    <button class="confirm-btn secondary" id="btn-back-sum">CLOSE</button>
                    <button class="confirm-btn nav-btn" id="btn-next">&gt;</button>
                </div>
            </div>

            <!-- Party Screen -->
            <div id="party-screen" class="hidden">
                <div class="party-header" id="party-header-text">POKEMON PARTY</div>
                <div id="party-list" class="party-list"></div>
                <div id="party-context" class="hidden"></div>
                <div class="btn-bar" id="party-close-btn" onclick="Battle.uiToMenu()">CLOSE</div>
            </div>

            <!-- Pack Screen -->
            <div id="pack-screen" class="hidden">
                <div class="pack-header">ITEM POCKET</div>
                <div class="pack-body">
                    <div class="pack-graphic">
                        <div class="bag-icon"></div>
                    </div>
                    <div class="pack-list" id="pack-list"></div>
                </div>
                <div class="pack-desc-box" id="pack-desc">Choose an item.</div>
            </div>

            <!-- EVOLUTION SCREEN (NEW) -->
            <div id="evolution-screen" class="hidden">
                <div class="evo-scene">
                    <div id="evo-bg" class="evo-bg"></div>
                    <div class="evo-sprite-container">
                        <img id="evo-sprite" src="">
                    </div>
                </div>
                <div class="evo-dialog-box" id="evo-dialog">
                    <div id="evo-text"></div>
                </div>
            </div>

            <!-- MOVE LEARN SCREEN -->
            <div id="move-learn-screen" class="hidden">
                <div class="ml-header">
                    <span id="ml-title-text" style="width:100%; text-align:center;">SELECT MOVE TO REPLACE</span>
                </div>
                <div class="ml-body">
                    <!-- Left Column: Sprite & Stats -->
                    <div class="ml-left-col">
                        <div class="ml-sprite-box">
                            <img id="ml-poke-sprite" src="">
                        </div>
                        <div class="ml-types" id="ml-types"></div>
                        <div class="ml-stats-container">
                            <div class="ml-stats-row"><span>ATTACK</span> <span id="ml-stat-atk">--</span></div>
                            <div class="ml-stats-row"><span>DEFENSE</span> <span id="ml-stat-def">--</span></div>
                            <div class="ml-stats-row"><span>SP. ATK</span> <span id="ml-stat-spa">--</span></div>
                            <div class="ml-stats-row"><span>SP. DEF</span> <span id="ml-stat-spd">--</span></div>
                            <div class="ml-stats-row"><span>SPEED</span> <span id="ml-stat-spe">--</span></div>
                        </div>
                    </div>
                    <!-- Right Column: Move List -->
                    <div class="ml-right-col" id="ml-move-list">
                        <!-- Moves injected via JS -->
                    </div>
                </div>
                <!-- Info Panel -->
                <div class="ml-info-panel">
                    <div class="ml-info-header">
                        <div id="ml-info-title">INFO</div>
                        <div class="ml-info-stats">
                            <span id="ml-info-power">PWR: --</span>
                            <span id="ml-info-acc">ACC: --</span>
                            <span id="ml-info-type">TYPE/NORMAL</span>
                        </div>
                    </div>
                    <div class="ml-info-desc" id="ml-info-desc">
                        Description text.
                    </div>
                </div>
                <!-- Dialog Overlay -->
                <div id="ml-dialog" class="ml-dialog hidden">
                    <div class="ml-dialog-box">
                        <div id="ml-dialog-text" class="ml-dialog-text">Forget move?</div>
                        <div class="ml-dialog-hint">Z: CONFIRM | X: CANCEL</div>
                    </div>
                </div>
            </div>

            <!-- RETRO SELECTION SCREEN -->
            <div id="selection-screen" class="hidden">
                <div class="sel-preview-box">
                    <img id="sel-preview-img" class="preview-sprite" src="" style="display:none">
                    <div id="sel-preview-shiny" class="shiny-mark">✦</div>
                </div>
                <div class="lab-table-area">
                    <div class="table-graphic" id="lab-table">
                        <div class="sel-cursor" id="sel-cursor"></div>
                    </div>
                </div>
                <div class="sel-desc-box" id="sel-text-box">SELECT A POKEMON</div>
            </div>

            <!-- POKEDEX SCREEN -->
            <div id="pokedex-screen" class="hidden">
                <div class="dex-header">
                    <span>POKEDEX</span>
                    <div class="dex-stats">
                        <span>SEEN: <span id="dex-seen-count">0</span></span>
                        <span>OWN: <span id="dex-caught-count">0</span></span>
                    </div>
                    <div class="dex-header-close" onclick="ScreenManager.pop()">BACK</div>
                </div>
                <div id="dex-list" class="dex-list"></div>

                <!-- Detail Overlay -->
                <div id="dex-detail-panel" class="dex-detail-panel">
                    <!-- New Header Row -->
                    <div class="detail-header-row">
                        <div id="detail-name" class="detail-name">LOADING...</div>
                        <div class="dex-detail-controls">
                            <div class="dex-nav-btn" onclick="PokedexScreen.navigateDetails(-1)">&lt;</div>
                            <div class="dex-nav-btn" onclick="PokedexScreen.navigateDetails(1)">&gt;</div>
                            <div class="dex-close-btn" onclick="PokedexScreen.closeDetails()">×</div>
                        </div>
                    </div>

                    <!-- Content Row: Sprite + Stats -->
                    <div class="detail-content-row">
                        <div class="detail-sprite-box">
                            <img id="detail-sprite" class="detail-large-sprite">
                        </div>
                        <div class="detail-info-col">
                            <div id="detail-types" class="detail-row"></div>
                            <div class="detail-stats-grid">
                                <div class="detail-stat-small">SEEN: <span id="detail-encounters">0</span></div>
                                <div class="detail-stat-small">SHINY: <span id="detail-shiny">NO</span></div>
                                <div class="detail-stat-small">BOSS: <span id="detail-boss">NO</span></div>
                                <div class="detail-stat-small">HT: <span id="detail-height">-.-m</span></div>
                                <div class="detail-stat-small">WT: <span id="detail-weight">-.-kg</span></div>
                            </div>
                        </div>
                    </div>
                    <div class="detail-bottom">
                        <div id="detail-desc" class="detail-desc-box">
                        </div>
                        <div class="detail-row">EVOLUTION CHAIN</div>
                        <div id="detail-evo-chain" class="detail-evo-chain"></div>
                    </div>

                </div>
            </div>

            <!-- Battle Scene -->
            <div class="scene hidden" id="scene">
                <div id="fx-container"
                    style="position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;"></div>

                <!-- ENEMY HUD -->
                <div class="hud" id="enemy-hud">
                    <div class="name">
                        <span id="enemy-name">LOADING...</span>
                        <span id="enemy-caught-icon" class="dex-pokeball caught"
                            style="display:none; width:8px; height:8px; margin-left:4px;"></span>
                        <!-- Pre-baked empty icons for Status and Rage -->
                        <span id="enemy-status-icon"
                            style="font-size:8px; font-weight:bold; margin-left:4px; text-shadow:1px 1px 0 #fff; display:none;"></span>
                        <span id="enemy-rage-icon" class="aggro-icon" style="display:none;"></span>
                    </div>
                    <div class="level" id="enemy-lvl">Lv15</div>
                    <div class="hp-box">
                        <span style="margin-right:2px; color:#e6ae27;">HP</span>
                        <div class="hp-bar-bg">
                            <div id="enemy-hp-bar" class="hp-fill"></div>
                        </div>
                    </div>
                </div>

                <img id="enemy-sprite" class="sprite" src="" alt="Enemy">
                <img id="player-sprite" class="sprite" src="" alt="Player">

                <!-- PLAYER HUD -->
                <div class="hud" id="player-hud">
                    <div class="name">
                        <span id="player-name">LOADING...</span>
                        <!-- Pre-baked empty icons for Status and Rage -->
                        <span id="player-status-icon"
                            style="font-size:8px; font-weight:bold; margin-left:4px; text-shadow:1px 1px 0 #fff; display:none;"></span>
                        <span id="player-rage-icon" class="aggro-icon" style="display:none;"></span>
                    </div>
                    <div class="level" id="player-lvl">Lv15</div>
                    <div class="hp-box">
                        <span style="margin-right:2px; color:#e6ae27;">HP</span>
                        <div class="hp-bar-bg">
                            <div id="player-hp-bar" class="hp-fill"></div>
                        </div>
                    </div>
                    <div id="player-hp-text">--/--</div>
                    <div class="exp-box">
                        <span style="font-size:6px; margin-right:1px;">EXP</span>
                        <div class="exp-bar-bg">
                            <div id="player-exp-bar" class="exp-fill"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dialog Box -->
            <div id="dialog-box" class="hidden">
                <div id="text-content">...</div>
                <div id="advance-arrow" class="hidden"></div>
                <div id="action-menu" class="hidden">
                    <div class="menu-item" id="opt-fight" onclick="BattleMenus.uiToMoves()">FIGHT</div>
                    <div class="menu-item" id="opt-pkmn" onclick="UI.hide('action-menu'); Game.openParty(false)">PKMN
                    </div>
                    <div class="menu-item" id="opt-pack" onclick="BattleMenus.openPack()">PACK</div>
                    <div class="menu-item" id="opt-run" onclick="BattleMenus.askRun()">RUN</div>
                </div>
                <div id="move-menu" class="hidden"></div>
            </div>
        </div>
    </div>


    <!-- Extracted Modules -->
    <script src="js/systems/utils.js"></script>
    <script src="js/systems/logger.js"></script>
    <script src="js/systems/screen_manager.js"></script>
    <script src="js/systems/dialog_manager.js"></script>

    <!-- Data & Config -->
    <script src="js/data/constants.js"></script>
    <script src="js/data/settings.js"></script>
    <script src="js/data/debug.js"></script>
    <script src="js/data/moves.js"></script>
    <script src="js/data/items.js"></script>

    <script src="js/systems/audio.js"></script>
    <script src="js/systems/api.js"></script>
    <script src="js/systems/storage.js"></script>
    <script src="js/systems/pokedex_data.js"></script>
    <script src="js/systems/input.js"></script>
    <script src="js/engine/encounter.js"></script>

    <script src="js/ui/ui.js"></script>
    <script src="js/core/mechanics.js"></script>
    <script src="js/core/capture.js"></script>
    <script src="js/core/environment.js"></script>
    <script src="js/core/effects.js"></script>
    <script src="js/core/moves_engine.js"></script>
    <script src="js/core/faint_manager.js"></script>
    <script src="js/core/rage_manager.js"></script>
    <script src="js/core/turn_manager.js"></script>
    <script src="js/ui/menus.js"></script>
    <script src="js/anim/anim_framework.js"></script>
    <!-- Modular Animation Registry -->
    <script src="js/anim/registry/core.js"></script>
    <script src="js/anim/registry/elemental.js"></script>
    <script src="js/anim/registry/physical.js"></script>
    <script src="js/anim/registry/nature.js"></script>
    <script src="js/anim/registry/mystic.js"></script>
    <script src="js/anim/animations.js"></script>
    <script src="js/screens/party.js"></script>
    <script src="js/screens/summary.js"></script>
    <script src="js/screens/selection.js"></script>
    <script src="js/screens/title_flow.js"></script>
    <script src="js/engine/ai.js"></script>
    <script src="js/core/evolution.js"></script>
    <script src="js/core/game.js"></script>
    <script src="js/core/battle.js"></script>
    <script src="js/screens/evolution_screen.js"></script>
    <script src="js/screens/move_learn.js"></script>
    <script src="js/screens/pokedex.js"></script>

    <script>
        // --- INITIALIZATION ---
        PokedexData.init();
        Input.init();
        ScreenManager.push('TITLE');
    </script>
</body>

</html>